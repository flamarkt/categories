(()=>{var t={n:e=>{var o=e&&e.__esModule?()=>e.default:()=>e;return t.d(o,{a:o}),o},d:(e,o)=>{for(var r in o)t.o(o,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:o[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},e={};(()=>{"use strict";t.r(e),t.d(e,{backoffice:()=>Q,common:()=>g});const o=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{}).app;var r=t.n(o);const n=flarum.core.compat["common/extend"],i=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{})["components/BackofficeNav"];var a=t.n(i);const s=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["components/ActiveLinkButton"];var c=t.n(s);const u=flarum.core.compat["common/Model"];var l=t.n(u);function f(t,e){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},f(t,e)}function p(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,f(t,e)}var d=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).slug=l().attribute("slug"),e.title=l().attribute("title"),e.description=l().attribute("description"),e.priority=l().attribute("priority"),e.productCount=l().attribute("productCount"),e.isRoot=l().attribute("isRoot"),e.isHidden=l().attribute("isHidden"),e.parent=l().hasOne("parent"),e}return p(e,t),e.prototype.apiEndpoint=function(){return"/flamarkt/categories"+(this.exists?"/"+this.data.id:"")},e}(l()),g={"models/Category":d,"utils/sortCategories":function(t){return t.slice(0).sort((function(t,e){var o=t.priority(),r=e.priority();return o>r?-1:r>o||t.title()>e.title()?1:-1}))}};const h=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{})["components/AbstractList"];var y=t.n(h);const v=flarum.core.compat["common/components/Link"];var b=t.n(v);const k=flarum.core.compat["common/components/LinkButton"];var x=t.n(k),w=function(t){function e(){return t.apply(this,arguments)||this}p(e,t);var o=e.prototype;return o.head=function(){var e=t.prototype.head.call(this);return e.add("parent",m("th","Parent")),e.add("title",m("th","Title")),e.add("productCount",m("th","Products")),e},o.columns=function(e){var o=t.prototype.columns.call(this,e),n=e.parent();return o.add("parent",m("td",n?m(b(),{href:r().route("categories.show",{id:n.id()})},n.title()):m("em","Root"))),o.add("title",m("td",e.title())),o.add("productCount",m("td",e.productCount())),o},o.actions=function(e){var o=t.prototype.actions.call(this,e);return o.add("edit",x().component({className:"Button Button--icon",icon:"fas fa-pen",href:r().route("categories.show",{id:e.id()})})),o},e}(y());const C=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["components/AbstractRelationshipSelect"];var S=t.n(C);const P=flarum.core.compat["common/helpers/highlight"];var F=t.n(P),L=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).resultsCache=new Map,e}p(e,t);var o=e.prototype;return o.search=function(t){var e=this;return t?(t=t.toLowerCase(),r().store.find("flamarkt/categories",{filter:{q:t},page:{limit:5}}).then((function(o){e.resultsCache.set(t,o),m.redraw()}))):(m.redraw(),Promise.resolve())},o.results=function(t){if(!t)return[];t=t.toLowerCase();var e=this.resultsCache.get(t);return void 0===e?null:e||[]},o.item=function(t,e){return[e?F()(t.title(),e):t.title()]},e}(S());const O=flarum.core.compat["common/components/Page"];var B=t.n(O);const I=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["states/AbstractListState"];var A=function(t){function e(){return t.apply(this,arguments)||this}return p(e,t),e.prototype.type=function(){return"flamarkt/categories"},e}(t.n(I)()),j=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).list=void 0,e}p(e,t);var o=e.prototype;return o.oninit=function(e){t.prototype.oninit.call(this,e),this.list=new A,this.list.refresh()},o.view=function(){return m(".ProductIndexPage",m(".container",[m(".Form-group",[x().component({className:"Button",href:r().route("categories.show",{id:"new"})},"New category")]),m(w,{list:this.list})]))},e}(B());const N=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["pages/AbstractShowPage"];var R=t.n(N);const _=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{})["components/SubmitButton"];var T=t.n(_);const M=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{})["components/SoftDeleteButton"];var D=t.n(M);const H=((flarum.extensions["flamarkt-backoffice"]||{}).backoffice||{})["components/PermanentDeleteButton"];var q=t.n(H);const z=flarum.core.compat["common/components/LoadingIndicator"];var E=t.n(z);const G=flarum.core.compat["common/utils/ItemList"];var J=t.n(G),K=function(t){function e(){for(var e,o=arguments.length,r=new Array(o),n=0;n<o;n++)r[n]=arguments[n];return(e=t.call.apply(t,[this].concat(r))||this).category=null,e.saving=!1,e.dirty=!1,e.parent=null,e.slug="",e.title="",e.description="",e.priority="",e}p(e,t);var o=e.prototype;return o.newRecord=function(){return r().store.createRecord("flamarkt-categories")},o.findType=function(){return"flamarkt/categories"},o.show=function(t){this.category=t,this.parent=t.parent()||null,this.slug=t.slug()||"",this.title=t.title()||"",this.description=t.description()||"",this.priority=t.priority()+"",r().setTitle(t.title()),r().setTitleCount(0)},o.view=function(){return this.category?m("form.CategoryShowPage",{onsubmit:this.onsubmit.bind(this)},m(".container.container--narrow",this.fields().toArray())):E().component()},o.fields=function(){var t=this,e=new(J());return e.add("parent",m(".Form-group",[m("label","Parent"),m(L,{relationship:this.parent,onchange:function(e){t.parent=e,t.dirty=!0},hasOne:!0})]),100),e.add("slug",m(".Form-group",[m("label","Slug"),m("input.FormControl",{type:"text",value:this.slug,oninput:function(e){t.slug=e.target.value,t.dirty=!0}})]),80),e.add("title",m(".Form-group",[m("label","Title"),m("input.FormControl",{type:"text",value:this.title,oninput:function(e){t.title=e.target.value,t.dirty=!0}})]),60),e.add("description",m(".Form-group",[m("label","Description"),m("textarea.FormControl",{value:this.description,oninput:function(e){t.description=e.target.value,t.dirty=!0}})]),40),e.add("priority",m(".Form-group",[m("label","Priority"),m("input.FormControl",{type:"number",min:0,value:this.priority,oninput:function(e){t.priority=e.target.value,t.dirty=!0}})]),20),e.add("submit",m(".Form-group",[T().component({loading:this.saving,dirty:this.dirty,exists:this.category.exists})," ",D().component({model:this.category})," ",q().component({model:this.category,afterdelete:function(){m.route.set(r().route("categories.index"))}})]),-10),e},o.data=function(){return{slug:this.slug,title:this.title,description:this.description,priority:parseInt(this.priority),relationships:{parent:this.parent}}},o.onsubmit=function(t){var e=this;t.preventDefault(),this.saving=!0,this.category.save(this.data()).then((function(t){e.category=t,e.saving=!1,e.dirty=!1,m.redraw(),m.route.set(r().route.category(t))})).catch((function(t){e.saving=!1,m.redraw()}))},e}(R()),Q={"components/CategoryList":w,"components/CategoryRelationshipSelect":L,"pages/CategoryIndexPage":j,"pages/CategoryShowPage":K,"states/CategoryListState":A};const U=((flarum.extensions["flamarkt-core"]||{}).backoffice||{})["components/ProductList"];var V=t.n(U);const W=((flarum.extensions["flamarkt-core"]||{}).backoffice||{})["pages/ProductShowPage"];var X=t.n(W);r().initializers.add("flamarkt-categories",(function(){r().extensionData.for("flamarkt-categories").registerSetting({setting:"flamarkt-categories.listInSideNav",type:"switch",label:r().translator.trans("flamarkt-categories.backoffice.settings.listInSideNav")}).registerSetting({setting:"flamarkt-categories.indexInSideNav",type:"switch",label:r().translator.trans("flamarkt-categories.backoffice.settings.indexInSideNav")}).registerSetting({setting:"flamarkt-categories.indexInBreadcrumb",type:"switch",label:r().translator.trans("flamarkt-categories.backoffice.settings.indexInBreadcrumb")}),r().store.models["flamarkt-categories"]=d,r().store.models["flamarkt-products"].prototype.categories=l().hasMany("categories"),r().routes["categories.index"]={path:"/categories",component:j},r().routes["categories.show"]={path:"/categories/:id",component:K},r().route.category=function(t){return r().route("categories.show",{id:t.id()})},(0,n.extend)(a().prototype,"items",(function(t){t.add("categories",c().component({href:r().route("categories.index"),icon:"fas fa-th-list",activeRoutes:["categories.*"]},r().translator.trans("flamarkt-categories.backoffice.nav.categories")))})),(0,n.extend)(V().prototype,"head",(function(t){t.add("categories",m("th",r().translator.trans("flamarkt-categories.backoffice.products.head.category")),20)})),(0,n.extend)(V().prototype,"columns",(function(t,e){t.add("categories",m("td",(e.categories()||[]).map((function(t){return t.title()})).join(", ")),20)})),(0,n.extend)(X().prototype,"oninit",(function(){this.categories=[]})),(0,n.extend)(X().prototype,"show",(function(t,e){this.categories=e.categories()||[]})),(0,n.extend)(X().prototype,"fields",(function(t){var e=this;t.add("categories",m(".Form-group",[m("label","Categories"),m(L,{relationship:this.categories,onchange:function(t){e.categories=t,e.dirty=!0}})]),100)})),(0,n.extend)(X().prototype,"data",(function(t){t.relationships=t.relationships||{},t.relationships.categories=this.categories}))}))})(),module.exports=e})();
//# sourceMappingURL=backoffice.js.map