(()=>{var t={n:r=>{var e=r&&r.__esModule?()=>r.default:()=>r;return t.d(e,{a:e}),e},d:(r,e)=>{for(var o in e)t.o(e,o)&&!t.o(r,o)&&Object.defineProperty(r,o,{enumerable:!0,get:e[o]})},o:(t,r)=>Object.prototype.hasOwnProperty.call(t,r),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},r={};(()=>{"use strict";t.r(r),t.d(r,{common:()=>C,extend:()=>K,forum:()=>J});const e=flarum.core.compat["forum/app"];var o=t.n(e);const a=flarum.core.compat["common/extenders"];var n=t.n(a);const i=flarum.core.compat["common/extend"],c=flarum.core.compat["common/components/LinkButton"];var s=t.n(c);const u=flarum.core.compat["common/components/Separator"];var l=t.n(u);const f=flarum.core.compat["forum/components/IndexPage"];var p=t.n(f);const d=((flarum.extensions["flamarkt-core"]||{}).common||{})["models/Product"];var g=t.n(d);const y=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/ProductShowLayout"];var h=t.n(y);function v(t,r){return v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,r){return t.__proto__=r,t},v(t,r)}function b(t,r){t.prototype=Object.create(r.prototype),t.prototype.constructor=t,v(t,r)}const k=flarum.core.compat["common/Model"];var x=t.n(k),S=function(t){function r(){for(var r,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return(r=t.call.apply(t,[this].concat(o))||this).slug=x().attribute("slug"),r.title=x().attribute("title"),r.description=x().attribute("description"),r.priority=x().attribute("priority"),r.productCount=x().attribute("productCount"),r.isRoot=x().attribute("isRoot"),r.isHidden=x().attribute("isHidden"),r.parent=x().hasOne("parent"),r}return b(r,t),r.prototype.apiEndpoint=function(){return"/flamarkt/categories"+(this.exists?"/"+this.data.id:"")},r}(x());function w(t){return t.slice(0).sort((function(t,r){var e=t.priority(),o=r.priority();return e>o?-1:o>e||t.title()>r.title()?1:-1}))}var C={"models/Category":S,"utils/sortCategories":w};const P=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/AbstractShopLayout"];var I=t.n(P);const L=flarum.core.compat["common/components/Link"];var O=t.n(L),T=function(t){function r(){return t.apply(this,arguments)||this}b(r,t);var e=r.prototype;return e.title=function(){return o().translator.trans("flamarkt-categories.forum.categories.headingTitle")},e.content=function(){var t=this,r=o().store.all("flamarkt-categories"),e=w(r.filter((function(t){return t.isRoot()})));return m("ul",w(e).map((function(e){var o=r.filter((function(t){return t.parent()===e}));return t.link(e,o.length>0?m("ul",w(o).map((function(r){return t.link(r)}))):null)})))},e.link=function(t,r){return void 0===r&&(r=null),m("li",[O().component({href:o().route.category(t)},t.title()),r])},r}(I());const _=((flarum.extensions["flamarkt-core"]||{}).forum||{})["layouts/ProductIndexLayout"];function j(t,r,e){if(void 0===e&&(e=!1),o().forum.attribute("flamarktCategoriesIndexInBreadcrumb")&&t.add("categories",s().component({href:o().route("flamarkt.categories.index")},o().translator.trans("flamarkt-categories.forum.breadcrumb.categories"))),r)for(var a=[],n=r;;){n===r&&e||t.add("category-"+n.id(),s().component({href:o().route.category(n)},n.title()));var i=r.parent();if(!i||-1!==a.indexOf(i))break;n=i,a.push(i)}}var B=function(t){function r(){for(var r,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return(r=t.call.apply(t,[this].concat(o))||this).attrs=void 0,r}b(r,t);var e=r.prototype;return e.breadcrumbItems=function(){var r=t.prototype.breadcrumbItems.call(this);return j(r,this.attrs.category,!0),r},e.title=function(){return this.attrs.category?this.attrs.category.title():o().translator.trans("flamarkt-categories.forum.category.titleWhileLoading")},e.currentPageHref=function(){return""},r}(t.n(_)());const A=flarum.core.compat["common/components/Page"];var M=t.n(A);const N=flarum.core.compat["common/components/LoadingIndicator"];var R=t.n(N);const E=flarum.core.compat["common/utils/extractText"];var H=t.n(E),q=function(t){function r(){for(var r,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return(r=t.call.apply(t,[this].concat(o))||this).loading=!1,r}b(r,t);var e=r.prototype;return e.oninit=function(r){var e=this;t.prototype.oninit.call(this,r),o().setTitle(H()(o().translator.trans("flamarkt-categories.forum.categories.browserTitle"))),o().setTitleCount(0),this.loading=!0,o().store.find("flamarkt/categories").then((function(){e.loading=!1,m.redraw()}))},e.view=function(){return this.loading?R().component():T.component()},r}(M());const F=((flarum.extensions["flamarkt-backoffice"]||{}).common||{})["pages/AbstractShowPage"];var z=t.n(F);const W=((flarum.extensions["flamarkt-core"]||{}).common||{})["states/ProductListState"];var D=t.n(W),G=function(t){function r(){for(var r,e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return(r=t.call.apply(t,[this].concat(o))||this).category=null,r.listState=void 0,r}b(r,t);var e=r.prototype;return e.oninit=function(r){t.prototype.oninit.call(this,r),this.listState=this.initState()},e.initState=function(){var t=m.route.param();return new(D())({sort:t.sort})},e.findType=function(){return"flamarkt/categories"},e.requestParams=function(){var r=t.prototype.requestParams.call(this);return r.bySlug=!0,r},e.show=function(t){this.category=t,o().setTitle(t.title()),o().setTitleCount(0),this.listState.params.filter={category:t.slug()},this.listState.refresh()},e.view=function(){return B.component({category:this.category,state:this.listState})},r}(z()),J={"layouts/CategoryIndexLayout":T,"layouts/CategoryShowLayout":B,"pages/CategoryIndexPage":q,"pages/CategoryShowPage":G,"utils/buildBreadcrumb":j},K=[(new(n().Store)).add("flamarkt-categories",S),new(n().Model)(g()).hasMany("categories"),(new(n().Routes)).add("flamarkt.categories.index","/categories",q).add("flamarkt.categories.show","/categories/:id",G)];o().initializers.add("flamarkt-categories",(function(){o().route.category=function(t){return o().route("flamarkt.categories.show",{id:t.slug()})},(0,i.extend)(p().prototype,"navItems",(function(t){if(o().forum.attribute("flamarktCategoriesIndexInSideNav")&&t.add("flamarkt-categories",s().component({icon:"fas fa-th-large",href:o().route("flamarkt.categories.index")},o().translator.trans("flamarkt-categories.forum.nav.allCategories")),-10),o().forum.attribute("flamarktCategoriesListInSideNav")&&!o().current.matches(q)){t.add("separator",l().component(),-12);var r=o().store.all("flamarkt-categories"),e=w(r.filter((function(t){return t.isRoot()}))),a="flamarkt.categories.show"===o().current.get("routeName")&&m.route.param("id"),n=a?r.find((function(t){return t.slug()===a})):void 0;e.forEach((function(e){var a=r.filter((function(t){return t.parent()===e})),i=e===n||n&&-1!==a.indexOf(n);t.add("flamarkt-category"+e.id(),s().component({className:"FlamarktCategoryLinkButton",icon:"fas fa-tag",href:o().route.category(e),active:i},[e.title(),m("span.Button-badge",e.productCount())]),-14),i&&a.length&&w(a).forEach((function(r){t.add("flamarkt-category"+r.id(),s().component({className:"FlamarktCategoryLinkButton child",icon:"fas fa-tag",href:o().route.category(r)},[r.title(),m("span.Button-badge",r.productCount())]),-14)}))}))}})),(0,i.extend)(h().prototype,"breadcrumbItems",(function(t){var r,e=(null==(r=this.product())?void 0:r.categories())||[];e.length&&j(t,w(e)[0])}))}))})(),module.exports=r})();
//# sourceMappingURL=forum.js.map