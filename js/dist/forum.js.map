{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@flamarkt/categories/webpack/bootstrap","webpack://@flamarkt/categories/webpack/runtime/compat get default export","webpack://@flamarkt/categories/webpack/runtime/define property getters","webpack://@flamarkt/categories/webpack/runtime/hasOwnProperty shorthand","webpack://@flamarkt/categories/webpack/runtime/make namespace object","webpack://@flamarkt/categories/external root \"flarum.core.compat['forum/app']\"","webpack://@flamarkt/categories/external root \"flarum.core.compat['common/extenders']\"","webpack://@flamarkt/categories/external root \"flarum.core.compat['common/extend']\"","webpack://@flamarkt/categories/external root \"flarum.core.compat['common/components/LinkButton']\"","webpack://@flamarkt/categories/external root \"flarum.core.compat['common/components/Separator']\"","webpack://@flamarkt/categories/external root \"flarum.core.compat['forum/components/IndexPage']\"","webpack://@flamarkt/categories/external root \"((flarum.extensions['flamarkt-core']||{})['common']||{})['models/Product']\"","webpack://@flamarkt/categories/external root \"((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/ProductShowLayout']\"","webpack://@flamarkt/categories/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@flamarkt/categories/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@flamarkt/categories/external root \"flarum.core.compat['common/Model']\"","webpack://@flamarkt/categories/./src/common/models/Category.ts","webpack://@flamarkt/categories/./src/common/utils/sortCategories.ts","webpack://@flamarkt/categories/./src/common/compat.ts","webpack://@flamarkt/categories/external root \"((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/AbstractShopLayout']\"","webpack://@flamarkt/categories/external root \"flarum.core.compat['common/components/Link']\"","webpack://@flamarkt/categories/./src/forum/layouts/CategoryIndexLayout.ts","webpack://@flamarkt/categories/external root \"((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/ProductIndexLayout']\"","webpack://@flamarkt/categories/./src/forum/utils/buildBreadcrumb.ts","webpack://@flamarkt/categories/./src/forum/layouts/CategoryShowLayout.ts","webpack://@flamarkt/categories/external root \"flarum.core.compat['common/components/Page']\"","webpack://@flamarkt/categories/external root \"flarum.core.compat['common/components/LoadingIndicator']\"","webpack://@flamarkt/categories/external root \"flarum.core.compat['common/utils/extractText']\"","webpack://@flamarkt/categories/./src/forum/pages/CategoryIndexPage.ts","webpack://@flamarkt/categories/external root \"((flarum.extensions['flamarkt-backoffice']||{})['common']||{})['pages/AbstractShowPage']\"","webpack://@flamarkt/categories/external root \"((flarum.extensions['flamarkt-core']||{})['common']||{})['states/ProductListState']\"","webpack://@flamarkt/categories/./src/forum/pages/CategoryShowPage.ts","webpack://@flamarkt/categories/./src/forum/compat.ts","webpack://@flamarkt/categories/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extenders'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LinkButton'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Separator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/IndexPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['common']||{})['models/Product'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/ProductShowLayout'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/Model'];","import Model from 'flarum/common/Model';\n\nexport default class Category extends Model {\n    slug = Model.attribute<string>('slug');\n    title = Model.attribute<string>('title');\n    description = Model.attribute<string>('description');\n    priority = Model.attribute<number>('priority');\n    productCount = Model.attribute<number>('productCount');\n    isRoot = Model.attribute<boolean>('isRoot');\n    isHidden = Model.attribute<boolean>('isHidden');\n\n    parent = Model.hasOne<Category>('parent');\n\n    apiEndpoint() {\n        return '/flamarkt/categories' + (this.exists ? '/' + (this.data as any).id : '');\n    }\n}\n","import Category from '../models/Category';\n\n/**\n * Sort a list of categories according to the built-in rules:\n * Priority, then alphabetical order\n * This method is only intended to filter one level of categories at a time\n * @param categories\n */\nexport default function sortCategories(categories: Category[]) {\n    return categories.slice(0).sort((a, b) => {\n        const aPriority = a.priority();\n        const bPriority = b.priority();\n\n        if (aPriority > bPriority) {\n            return -1;\n        }\n\n        if (bPriority > aPriority) {\n            return 1;\n        }\n\n        return a.title() > b.title() ? 1 : -1;\n    });\n}\n","import Category from './models/Category';\nimport sortCategories from './utils/sortCategories';\n\nexport const common = {\n    'models/Category': Category,\n    'utils/sortCategories': sortCategories,\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/AbstractShopLayout'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Link'];","import {Children} from 'mithril';\nimport app from 'flarum/forum/app';\nimport AbstractShopLayout from 'flamarkt/core/forum/layouts/AbstractShopLayout';\nimport Link from 'flarum/common/components/Link';\nimport Category from '../../common/models/Category';\nimport sortCategories from '../../common/utils/sortCategories';\n\nexport default class CategoryIndexLayout extends AbstractShopLayout {\n    title() {\n        return app.translator.trans('flamarkt-categories.forum.categories.headingTitle');\n    }\n\n    content() {\n        const allCategories = app.store.all<Category>('flamarkt-categories');\n        const rootCategories = sortCategories(allCategories.filter(c => c.isRoot()));\n\n        return m('ul', sortCategories(rootCategories).map(category => {\n            const childCategories = allCategories.filter(c => c.parent() === category);\n\n            return this.link(category, childCategories.length > 0 ? m('ul', sortCategories(childCategories).map(category => {\n                return this.link(category);\n            })) : null);\n        }));\n    }\n\n    link(category: Category, children: Children = null): Children {\n        return m('li', [\n            Link.component({\n                href: app.route.category(category),\n            }, category.title()),\n            children,\n        ]);\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['forum']||{})['layouts/ProductIndexLayout'];","import app from 'flarum/forum/app';\nimport ItemList from 'flarum/common/utils/ItemList';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport Category from '../../common/models/Category';\n\nexport default function (items: ItemList<any>, category: Category | null | undefined, onlyParents: boolean = false) {\n    if (app.forum.attribute('flamarktCategoriesIndexInBreadcrumb')) {\n        items.add('categories', LinkButton.component({\n            href: app.route('flamarkt.categories.index'),\n        }, app.translator.trans('flamarkt-categories.forum.breadcrumb.categories')));\n    }\n\n    // Allow passing no category as it's easier on pages where the data is loaded asynchronously\n    // It's also more resilient to errors if extensions call it with invalid data\n    if (!category) {\n        return;\n    }\n\n    const categoriesShown = [];\n    let loopCategory: Category = category;\n\n    while (true) {\n        // Skip first category if onlyParents is set\n        // Useful when showing breadcrumb to category itself\n        if (loopCategory !== category || !onlyParents) {\n            items.add('category-' + loopCategory.id(), LinkButton.component({\n                href: app.route.category(loopCategory),\n            }, loopCategory.title()));\n        }\n\n        const nextCategory = category.parent();\n\n        // Exit when no more parent and prevent loops inside category tree\n        if (!nextCategory || categoriesShown.indexOf(nextCategory) !== -1) {\n            break;\n        }\n\n        loopCategory = nextCategory;\n        categoriesShown.push(nextCategory);\n    }\n}\n","import app from 'flarum/forum/app';\nimport ProductIndexLayout, {ProductIndexLayoutAttrs} from 'flamarkt/core/forum/layouts/ProductIndexLayout';\nimport Category from '../../common/models/Category';\nimport buildBreadcrumb from '../utils/buildBreadcrumb';\n\nexport interface CategoryShowLayoutAttrs extends ProductIndexLayoutAttrs {\n    category: Category | null,\n}\n\nexport default class CategoryShowLayout extends ProductIndexLayout<CategoryShowLayoutAttrs> {\n    attrs!: CategoryShowLayoutAttrs\n\n    breadcrumbItems() {\n        const items = super.breadcrumbItems();\n\n        buildBreadcrumb(items, this.attrs.category, true);\n\n        return items;\n    }\n\n    title() {\n        if (!this.attrs.category) {\n            return app.translator.trans('flamarkt-categories.forum.category.titleWhileLoading');\n        }\n\n        return this.attrs.category.title();\n    }\n\n    currentPageHref() {\n        // We need to override this method because ProductIndexLayout uses it to signal whether it's the homepage\n        return '';\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Page'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/LoadingIndicator'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/utils/extractText'];","import {Vnode} from 'mithril';\nimport app from 'flarum/forum/app';\nimport Page from 'flarum/common/components/Page';\nimport LoadingIndicator from 'flarum/common/components/LoadingIndicator';\nimport extractText from 'flarum/common/utils/extractText';\nimport CategoryIndexLayout from '../layouts/CategoryIndexLayout';\n\nexport default class CategoryIndexPage extends Page {\n    loading: boolean = false;\n\n    oninit(vnode: Vnode) {\n        super.oninit(vnode);\n\n        app.setTitle(extractText(app.translator.trans('flamarkt-categories.forum.categories.browserTitle')));\n        app.setTitleCount(0);\n\n        this.loading = true;\n        app.store.find('flamarkt/categories').then(() => {\n            this.loading = false;\n            m.redraw();\n        });\n    }\n\n    view() {\n        return this.loading ? LoadingIndicator.component() : CategoryIndexLayout.component();\n    }\n}\n","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-backoffice']||{})['common']||{})['pages/AbstractShowPage'];","const __WEBPACK_NAMESPACE_OBJECT__ = ((flarum.extensions['flamarkt-core']||{})['common']||{})['states/ProductListState'];","import {Vnode} from 'mithril';\nimport app from 'flarum/forum/app';\nimport AbstractShowPage from 'flamarkt/backoffice/common/pages/AbstractShowPage';\nimport ProductListState from 'flamarkt/core/common/states/ProductListState';\nimport CategoryShowLayout from '../layouts/CategoryShowLayout';\nimport Category from '../../common/models/Category';\n\nexport default class CategoryShowPage extends AbstractShowPage {\n    category: Category | null = null;\n    listState!: ProductListState;\n\n    oninit(vnode: Vnode) {\n        super.oninit(vnode);\n\n        this.listState = this.initState();\n    }\n\n    initState() {\n        const params = m.route.param();\n\n        return new ProductListState({\n            sort: params.sort,\n        });\n    }\n\n    findType() {\n        return 'flamarkt/categories';\n    }\n\n    requestParams(): any {\n        const params = super.requestParams();\n\n        params.bySlug = true;\n\n        return params;\n    }\n\n    show(category: Category) {\n        this.category = category;\n\n        app.setTitle(category.title());\n        app.setTitleCount(0);\n\n        this.listState.params.filter = {\n            category: category.slug(),\n        };\n        this.listState.refresh();\n    }\n\n    view() {\n        return CategoryShowLayout.component({\n            category: this.category,\n            state: this.listState,\n        });\n    }\n}\n","import CategoryIndexLayout from './layouts/CategoryIndexLayout';\nimport CategoryShowLayout from './layouts/CategoryShowLayout';\nimport CategoryIndexPage from './pages/CategoryIndexPage';\nimport CategoryShowPage from './pages/CategoryShowPage';\nimport buildBreadcrumb from './utils/buildBreadcrumb';\n\nexport const forum = {\n    'layouts/CategoryIndexLayout': CategoryIndexLayout,\n    'layouts/CategoryShowLayout': CategoryShowLayout,\n    'pages/CategoryIndexPage': CategoryIndexPage,\n    'pages/CategoryShowPage': CategoryShowPage,\n    'utils/buildBreadcrumb': buildBreadcrumb,\n}\n","import app from 'flarum/forum/app';\nimport Extend from 'flarum/common/extenders';\nimport {extend} from 'flarum/common/extend';\nimport LinkButton from 'flarum/common/components/LinkButton';\nimport Separator from 'flarum/common/components/Separator';\nimport IndexPage from 'flarum/forum/components/IndexPage';\nimport Product from 'flamarkt/core/common/models/Product';\nimport ProductShowLayout from 'flamarkt/core/forum/layouts/ProductShowLayout';\nimport {common} from '../common/compat';\nimport {forum} from './compat';\nimport Category from '../common/models/Category';\nimport sortCategories from '../common/utils/sortCategories';\nimport CategoryIndexPage from './pages/CategoryIndexPage';\nimport CategoryShowPage from './pages/CategoryShowPage';\nimport buildBreadcrumb from './utils/buildBreadcrumb';\n\nconst extenders = [\n    new Extend.Store()\n        .add('flamarkt-categories', Category),\n    new Extend.Model(Product)\n        .hasMany('categories'),\n    new Extend.Routes()\n        .add('flamarkt.categories.index', '/categories', CategoryIndexPage)\n        .add('flamarkt.categories.show', '/categories/:id', CategoryShowPage),\n];\n\nexport {\n    extenders as extend,\n    common,\n    forum,\n};\n\napp.initializers.add('flamarkt-categories', () => {\n    app.route.category = category => {\n        return app.route('flamarkt.categories.show', {\n            id: category.slug(),\n        });\n    };\n\n    extend(IndexPage.prototype, 'navItems', function (items) {\n        if (app.forum.attribute('flamarktCategoriesIndexInSideNav')) {\n            items.add('flamarkt-categories', LinkButton.component({\n                icon: 'fas fa-th-large',\n                href: app.route('flamarkt.categories.index'),\n            }, app.translator.trans('flamarkt-categories.forum.nav.allCategories')), -10);\n        }\n\n        if (!app.forum.attribute('flamarktCategoriesListInSideNav')) {\n            return;\n        }\n\n        if (app.current.matches(CategoryIndexPage)) return;\n\n        items.add('separator', Separator.component(), -12);\n\n        const allCategories = app.store.all<Category>('flamarkt-categories');\n        const rootCategories = sortCategories(allCategories.filter(c => c.isRoot()));\n\n        // TODO: set active if current product page contains category\n        const activeCategorySlug = app.current.get('routeName') === 'flamarkt.categories.show' && m.route.param('id');\n        const activeCategory: Category | undefined = activeCategorySlug ? allCategories.find(c => c.slug() === activeCategorySlug) : undefined;\n\n        rootCategories.forEach(category => {\n            const childCategories = allCategories.filter(c => c.parent() === category);\n            const active = category === activeCategory || (activeCategory && childCategories.indexOf(activeCategory) !== -1);\n\n            items.add('flamarkt-category' + category.id(), LinkButton.component({\n                className: 'FlamarktCategoryLinkButton',\n                icon: 'fas fa-tag',\n                href: app.route.category(category),\n                active,\n            }, [\n                category.title(),\n                m('span.Button-badge', category.productCount()),\n            ]), -14);\n\n            if (active && childCategories.length) {\n                sortCategories(childCategories).forEach(childCategory => {\n                    items.add('flamarkt-category' + childCategory.id(), LinkButton.component({\n                        className: 'FlamarktCategoryLinkButton child',\n                        icon: 'fas fa-tag',\n                        href: app.route.category(childCategory),\n                    }, [\n                        childCategory.title(),\n                        m('span.Button-badge', childCategory.productCount()),\n                    ]), -14);\n                });\n            }\n        });\n    });\n\n    extend(ProductShowLayout.prototype, 'breadcrumbItems', function (items) {\n        const categories = this.product()?.categories() || [];\n\n        if (!categories.length) {\n            return;\n        }\n\n        // Use the most important category if there are multiple ones\n        buildBreadcrumb(items, sortCategories(categories)[0]);\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","extensions","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","_inheritsLoose","subClass","superClass","create","constructor","Category","slug","Model","title","description","priority","productCount","isRoot","isHidden","parent","apiEndpoint","this","exists","data","id","sortCategories","categories","slice","sort","b","aPriority","bPriority","common","CategoryIndexLayout","app","content","allCategories","rootCategories","filter","c","m","map","category","childCategories","link","length","children","Link","href","AbstractShopLayout","items","onlyParents","add","LinkButton","categoriesShown","loopCategory","nextCategory","indexOf","push","CategoryShowLayout","attrs","breadcrumbItems","buildBreadcrumb","currentPageHref","ProductIndexLayout","CategoryIndexPage","loading","oninit","vnode","extractText","then","redraw","view","LoadingIndicator","component","Page","CategoryShowPage","listState","initState","params","route","param","ProductListState","findType","requestParams","bySlug","show","refresh","state","AbstractShowPage","forum","extenders","Extend","Product","hasMany","extend","IndexPage","icon","Separator","activeCategorySlug","activeCategory","find","undefined","forEach","active","className","childCategory","ProductShowLayout","product"],"sourceRoot":""}